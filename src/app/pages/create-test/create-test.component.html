<div class="create_test">
    <div class="header">
        <h1>💝 Crea tu Quiz de Amor 💝</h1>
        <p>Prepara preguntas especiales para conocer mejor a tu pareja</p>
    </div>

    <div class="quiz-info" *ngIf="!quizCreated">
        <div class="form-group">
            <label for="title">
                <span class="emoji">💌</span> Dale un título especial a tu quiz:
            </label>
            <input 
                type="text" 
                id="title" 
                name="title" 
                [(ngModel)]="quiz.title" 
                placeholder="Ej: Nuestro Quiz de Amor"
                required
                [class.is-invalid]="validationErrors['Title']"
            />
            <div class="error-message" *ngIf="validationErrors['Title']">
                {{ validationErrors['Title'] }}
            </div>
        </div>

        <div class="form-group">
            <label for="description">
                <span class="emoji">💭</span> Escribe un mensaje para tu pareja:
            </label>
            <textarea 
                id="description" 
                name="description" 
                [(ngModel)]="quiz.description" 
                placeholder="Ej: Quiero conocer más sobre ti y nuestro amor..."
                required
                [class.is-invalid]="validationErrors['Description']"
            ></textarea>
            <div class="error-message" *ngIf="validationErrors['Description']">
                {{ validationErrors['Description'] }}
            </div>
        </div>
    </div>

    <div class="quiz-form" *ngIf="!quizCreated">
        <div class="quiz-header" *ngIf="!mostrarListado">
            <h2>Crea tu Quiz de Amor 💝</h2>
        </div>

        <div class="question-form" *ngIf="!mostrarListado">
            <h3>Añade una Pregunta 💕</h3>
            <div class="form-group">
                <label for="questionText">Pregunta</label>
                <input 
                    type="text" 
                    id="questionText" 
                    [(ngModel)]="currentQuestion.text" 
                    placeholder="Escribe tu pregunta..."
                    [class.is-invalid]="validationErrors['Questions[0].Text']"
                />
                <div class="error-message" *ngIf="validationErrors['Questions[0].Text']">
                    {{ validationErrors['Questions[0].Text'] }}
                </div>
            </div>

            <div class="answers-section">
                <h4>Respuestas 💖</h4>
                <div class="form-group" *ngFor="let answer of currentQuestion.answers; let i = index">
                    <div class="answer-input">
                        <input 
                            type="radio" 
                            [id]="'correct' + i" 
                            [name]="'correct'" 
                            [checked]="answer.isCorrect" 
                            (change)="setCorrectAnswer(answer)">
                        <input 
                            type="text" 
                            [id]="'answer' + i" 
                            [(ngModel)]="answer.text" 
                            [placeholder]="'Respuesta ' + (i + 1)"
                            [class.is-invalid]="validationErrors['Questions[0].Answers[' + i + '].Text']">
                    </div>
                    <div class="error-message" *ngIf="validationErrors['Questions[0].Answers[' + i + '].Text']">
                        {{ validationErrors['Questions[0].Answers[' + i + '].Text'] }}
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button 
                    (click)="guardarPregunta()" 
                    [disabled]="isAddButtonDisabled()" 
                    class="btn-primary">
                    Guardar Pregunta
                </button>
                <button 
                    *ngIf="quiz.questions.length > 0" 
                    (click)="verPreguntas()" 
                    class="btn-secondary">
                    Ver Preguntas ({{ quiz.questions.length }})
                </button>
            </div>
        </div>

        <div class="questions-list" *ngIf="mostrarListado">
            <h3>Preguntas del Quiz 💝</h3>
            <div class="question-card" *ngFor="let question of quiz.questions; let i = index">
                <h4>Pregunta {{ i + 1 }}</h4>
                <p>{{ question.text }}</p>
                <ul>
                    <li *ngFor="let answer of question.answers" [class.correct]="answer.isCorrect">
                        {{ answer.text }}
                        <span *ngIf="answer.isCorrect" class="correct-badge">✓</span>
                    </li>
                </ul>
                <div class="button-group">
                    <button (click)="editarPregunta(i)" class="btn-secondary">Editar</button>
                    <button (click)="eliminarPregunta(i)" class="btn-danger">Eliminar</button>
                </div>
            </div>

            <div class="button-group">
                <button (click)="noVerPreguntas()" class="btn-secondary">
                    Añadir Más Preguntas
                </button>
                <button 
                    (click)="finalizarQuiz()" 
                    [disabled]="quiz.questions.length === 0" 
                    class="btn-primary">
                    Finalizar Quiz
                </button>
            </div>
        </div>

        <div class="messages">
            <div class="error-message" *ngIf="error">{{ error }}</div>
            <div class="loading-message" *ngIf="isLoading">Guardando quiz...</div>
        </div>
    </div>

    <div class="quiz-created" *ngIf="quizCreated">
        <div class="success-card">
            <h2>💝 ¡Tu Quiz de Amor está Listo! 💝</h2>
            <p>Has creado un quiz especial para tu pareja. ¡Compártelo con amor!</p>
            
            <div class="share-info">
                <p>Comparte este enlace con tu pareja:</p>
                <div class="share-link">
                    <span>answer-test/{{ quiz.id }}</span>
                    <button class="copy-btn" (click)="copyToClipboard()">
                        <span class="emoji">📋</span> Copiar
                    </button>
                </div>
            </div>

            <div class="final-actions">
                <button class="restart-btn" (click)="reiniciarQuiz()">
                    <span class="emoji">💕</span> Crear Otro Quiz
                </button>
            </div>
        </div>
    </div>
</div>