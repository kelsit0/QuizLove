<div class="answer-test">
    <div class="header">
        <h1>ğŸ’• Quiz de Amor ğŸ’•</h1>
        <p>Responde las preguntas de tu pareja</p>
    </div>

    <!-- BÃºsqueda de Quiz -->
    <div class="search-section" *ngIf="!quiz && !isLoading">
        <div class="search-card">
            <h2>ğŸ” Encuentra tu Quiz</h2>
            <p>Ingresa el cÃ³digo que te compartiÃ³ tu pareja</p>
            
            <div class="search-form">
                <input 
                    type="text" 
                    [(ngModel)]="quizId" 
                    placeholder="Ingresa el cÃ³digo del quiz"
                    [class.invalid]="error"
                >
                <button (click)="searchQuiz(quizId)" [disabled]="!quizId">
                    <span class="emoji">ğŸ’</span> Buscar Quiz
                </button>
            </div>

            <div class="error-message" *ngIf="error">
                {{ error }}
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="isLoading">
        <div class="loading-card">
            <div class="loading-animation">
                <span class="emoji">ğŸ’</span>
            </div>
            <p>Cargando tu quiz de amor...</p>
        </div>
    </div>

    <!-- Quiz Questions -->
    <div class="quiz-container" *ngIf="currentQuestion && !showResults && !isLoading">
        <div class="progress-bar">
            <div class="progress" [style.width]="progressPercentage + '%'"></div>
            <span class="progress-text">{{currentQuestionIndex + 1}} de {{totalQuestions}}</span>
        </div>

        <div class="question-card">
            <div class="question">
                <span class="emoji">â“</span>
                <h2>{{ currentQuestion.pregunta }}</h2>
            </div>

            <form (ngSubmit)="submitAnswer()" #answerForm="ngForm" class="answer-form">
                <div class="form-group">
                    <input 
                        type="text" 
                        [(ngModel)]="userAnswer" 
                        name="answer"
                        placeholder="Escribe tu respuesta aquÃ­..."
                        required
                        #answer="ngModel"
                        [class.invalid]="answer.invalid && answer.touched"
                    >
                </div>

                <button type="submit" [disabled]="!answerForm.valid" class="submit-btn">
                    <span class="emoji">ğŸ’</span> Enviar Respuesta
                </button>
            </form>
        </div>
    </div>

    <!-- Quiz Results -->
    <div class="results" *ngIf="showResults && quizResult">
        <div class="results-card">
            <h2>ğŸ’« Â¡Quiz Completado! ğŸ’«</h2>
            
            <div class="score">
                <div class="score-circle">
                    {{ correctAnswers }}/{{ totalQuestions }}
                </div>
                <p>Â¡Respuestas Correctas!</p>
            </div>

            <div class="answers-review">
                <h3>RevisiÃ³n de Respuestas</h3>
                <div class="answer-item" *ngFor="let answer of quizResult.answers; let i = index">
                    <div class="answer-header">
                        <span class="question-number">Pregunta {{i + 1}}</span>
                        <span class="result-icon" [class.correct]="answer.correct">
                            {{ answer.correct ? 'âœ…' : 'âŒ' }}
                        </span>
                    </div>
                    <p class="question-text">{{ quiz && quiz.questions[i] ? quiz.questions[i].pregunta : '' }}</p>
                    <div class="answer-details">
                        <p class="user-answer">
                            <strong>Tu respuesta:</strong> 
                            <span [class.incorrect]="!answer.correct">{{ answer.userAnswer }}</span>
                        </p>
                        <p class="correct-answer" *ngIf="!answer.correct">
                            <strong>Respuesta correcta:</strong> 
                            <span>{{ answer.correctAnswer }}</span>
                        </p>
                    </div>
                </div>
            </div>

            <div class="message">
                <p *ngIf="correctAnswers === totalQuestions">
                    ğŸ‰ Â¡Perfecto! Conoces muy bien a tu pareja ğŸ’‘
                </p>
                <p *ngIf="correctAnswers >= totalQuestions/2 && correctAnswers < totalQuestions">
                    ğŸ’– Â¡Bien hecho! EstÃ¡s en sintonÃ­a con tu pareja
                </p>
                <p *ngIf="correctAnswers < totalQuestions/2">
                    ğŸ’ Â¡Sigue conociÃ©ndose mÃ¡s! El amor crece cada dÃ­a
                </p>
            </div>

            <button (click)="restartQuiz()" class="restart-btn">
                <span class="emoji">ğŸ”„</span> Intentar de Nuevo
            </button>
        </div>
    </div>
</div>
